<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‚˜ì˜ ì„±ì¥ ë£¨í‹´ - INSWING</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e5e7eb;
      min-height: 100vh;
      padding-top: 80px;
    }

    /* ë„¤ë¹„ê²Œì´ì…˜ ë°” (ë‹¤ë¥¸ í˜ì´ì§€ì™€ ë™ì¼ ìŠ¤íƒ€ì¼) */
    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1.5rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.6);
      z-index: 100;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .nav-logo-mark {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #020617;
      font-weight: 800;
      font-size: 0.9rem;
      letter-spacing: 0.14em;
    }

    .nav-logo-text {
      color: #e5e7eb;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: 0.05em;
    }

    .nav-menu {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-link {
      padding: 0.5rem 1rem;
      border-radius: 999px;
      color: #94a3b8;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .nav-link:hover {
      color: #e5e7eb;
      background: rgba(148, 163, 184, 0.1);
      border-color: rgba(148, 163, 184, 0.3);
    }

    .nav-link.active {
      color: #0ea5e9;
      background: rgba(14, 165, 233, 0.1);
      border-color: rgba(14, 165, 233, 0.3);
    }

    .nav-link.logout {
      color: #f97316;
    }

    .nav-link.logout:hover {
      background: rgba(249, 115, 22, 0.1);
      border-color: rgba(249, 115, 22, 0.3);
    }

    /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .page-title {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .page-subtitle {
      color: #94a3b8;
      font-size: 0.95rem;
      margin-bottom: 1.8rem;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 16px;
      padding: 1.7rem 1.8rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.7);
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
      color: #e5e7eb;
    }

    .card-subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 1.2rem;
    }

    /* ìƒë‹¨ ìš”ì•½ ì¹´ë“œ */
    .summary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.9rem;
      margin-top: 0.8rem;
    }

    .summary-pill {
      padding: 0.55rem 0.85rem;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
    }

    .summary-label {
      color: #9ca3af;
    }

    .summary-value {
      font-weight: 600;
      color: #e5e7eb;
    }

    /* ì˜¤ëŠ˜ì˜ ë£¨í‹´ ì¹´ë“œ */
    .routine-main {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .routine-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.6);
      font-size: 0.8rem;
      color: #bbf7d0;
    }

    .routine-main-text {
      font-size: 1rem;
      line-height: 1.6;
      color: #e5e7eb;
    }

    .routine-focus-label {
      font-size: 0.82rem;
      color: #9ca3af;
      margin-top: 0.2rem;
      margin-bottom: 0.4rem;
    }

    .focus-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.4rem;
    }

    .focus-tag {
      padding: 0.28rem 0.7rem;
      border-radius: 999px;
      font-size: 0.78rem;
      border: 1px solid rgba(96, 165, 250, 0.7);
      background: rgba(15, 23, 42, 0.8);
      color: #bfdbfe;
    }

    .routine-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .routine-meta span {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .routine-actions {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
    }

    .btn {
      padding: 0.65rem 1.3rem;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #020617;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
    }

    .btn-outline {
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: transparent;
      color: #e5e7eb;
    }

    .btn-outline:hover {
      background: rgba(148, 163, 184, 0.15);
    }

    .btn-disabled {
      opacity: 0.45;
      cursor: default;
      pointer-events: none;
    }

    /* ìµœê·¼ 7ì¼ ì¹´ë“œ (ê°„ë‹¨ ê·¸ë˜í”„ ëŠë‚Œ ë°”) */
    .stat-list {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin-top: 0.4rem;
    }

    .stat-item {
      font-size: 0.82rem;
      color: #9ca3af;
    }

    .stat-label-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.2rem;
    }

    .stat-bar {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    .stat-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      border-radius: 999px;
      background: linear-gradient(90deg, #0ea5e9, #22c55e);
      width: 40%;
    }

    /* ëŒ€í‘œ ìŠ¤ìœ™ ì¹´ë“œ */
    .best-swing {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .best-swing-thumb {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.4);
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
    }

    .best-swing-thumb-inner {
      padding-top: 56%;
      position: relative;
    }

    .best-swing-thumb-inner span {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .best-swing-meta {
      font-size: 0.85rem;
      color: #9ca3af;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .best-swing-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.2rem;
    }

    .best-swing-tag {
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(251, 191, 36, 0.8);
      color: #facc15;
      background: rgba(15, 23, 42, 0.8);
    }

    /* í•˜ë‹¨ ì„¹ì…˜ : íŒ¨í„´ ìš”ì•½ */
    .bottom-grid {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 1.5rem;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
    }

    .pattern-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .pattern-list li::before {
      content: "â€¢ ";
      color: #22c55e;
    }

    .empty-state {
      font-size: 0.9rem;
      color: #9ca3af;
      text-align: center;
      padding: 1.5rem 0.5rem;
    }

    /* í† ìŠ¤íŠ¸ */
    .toast {
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      background: rgba(15, 23, 42, 0.95);
      border-radius: 999px;
      padding: 0.6rem 1.2rem;
      font-size: 0.85rem;
      color: #e5e7eb;
      border: 1px solid rgba(52, 211, 153, 0.7);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.7);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-out, transform 0.25s ease-out;
      z-index: 200;
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -6px);
    }

    @media (max-width: 992px) {
      .grid,
      .bottom-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .top-nav {
        height: 56px;
        padding: 0 1rem;
      }

      body {
        padding-top: 72px;
      }

      .nav-logo-text {
        display: none;
      }

      .nav-link {
        padding: 0.4rem 0.7rem;
        font-size: 0.8rem;
      }

      .card {
        padding: 1.4rem 1.4rem;
      }

      .page-title {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <nav class="top-nav">
    <a href="/ko/index.html" class="nav-logo">
      <span class="nav-logo-mark">INS</span>
      <span class="nav-logo-text">WING</span>
    </a>
    <div class="nav-menu">
      <a href="/app/upload.html" class="nav-link">ì—…ë¡œë“œ</a>
      <a href="/app/history.html" class="nav-link">íˆìŠ¤í† ë¦¬</a>
      <a href="/app/routine.html" class="nav-link ">ë£¨í‹´</a>
      <a href="#" onclick="logout(); return false;" class="nav-link logout">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
  </nav>

  <div class="container">
    <h1 class="page-title">ë‚˜ì˜ ì„±ì¥ ë£¨í‹´</h1>
    <p class="page-subtitle">
      ìµœê·¼ ìŠ¤ìœ™ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜¤ëŠ˜ ì§‘ì¤‘í•´ì•¼ í•  í¬ì¸íŠ¸ë¥¼ ì •ë¦¬í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.
      ì—…ë¡œë“œê°€ ë§ì•„ì§ˆìˆ˜ë¡ INSwing ì½”ì¹˜ê°€ Ianë‹˜ íŒ¨í„´ì„ ë” ë˜‘ë˜‘í•˜ê²Œ ê¸°ì–µí•©ë‹ˆë‹¤.
    </p>

    <!-- ìƒë‹¨ ê·¸ë¦¬ë“œ: ì˜¤ëŠ˜ ë£¨í‹´ / ìµœê·¼ 7ì¼ -->
    <div class="grid">
      <!-- ì˜¤ëŠ˜ì˜ ë£¨í‹´ ì¹´ë“œ -->
      <section class="card">
        <div class="routine-main">
          <div>
            <div class="card-title">ì˜¤ëŠ˜ì˜ ë£¨í‹´</div>
            <div class="card-subtitle" id="routineDateText">2025ë…„ 11ì›” 30ì¼ Â· v0 (ë”ë¯¸ ë°ì´í„°)</div>
          </div>

          <span class="routine-badge" id="routineGoalBadge">
            ì˜¤ëŠ˜ ëª©í‘œ Â· ë°©í–¥ì„±ê³¼ í”¼ë‹ˆì‹œ ì•ˆì •ê°
          </span>

          <p class="routine-main-text" id="routineMainText">
            ìµœê·¼ 2ì£¼ ë™ì•ˆ <strong>ë¨¸ë¦¬ í”ë“¤ë¦¼</strong>ê³¼ <strong>í”¼ë‹ˆì‹œ ë¶ˆì•ˆì •</strong> íƒœê·¸ê°€ ìì£¼ ë“±ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.
            ì˜¤ëŠ˜ì€ â€œë¨¸ë¦¬ ê³ ì •â€ê³¼ â€œí”¼ë‹ˆì‹œ ëê¹Œì§€ ìœ ì§€â€ ë‘ ê°€ì§€ë§Œ ì‹ ê²½ ì“°ëŠ” ë£¨í‹´ìœ¼ë¡œ ê°€ë³ê²Œ ìŠ¤ìœ™í•´ ë³´ì„¸ìš”.
          </p>

          <div>
            <div class="routine-focus-label">ì˜¤ëŠ˜ì˜ í¬ì»¤ìŠ¤ íƒœê·¸</div>
            <div class="focus-tags" id="focusTagContainer">
              <!-- JSì—ì„œ ì±„ì›€ -->
            </div>
          </div>

          <div class="routine-meta" id="routineMeta">
            <span><span style="width:6px;height:6px;border-radius:999px;background:#22c55e;display:inline-block;"></span> ìµœê·¼ 14ì¼ ìŠ¤ìœ™ 23ê°œ</span>
            <span>í‰ê·  ì ìˆ˜ 58ì  Â· ìµœê³  72ì </span>
            <span>ë“œë¼ì´ë²„ ìœ„ì£¼ Â· ì •ë©´ ì´¬ì˜ 80%</span>
          </div>

          <div class="routine-actions">
            <button class="btn btn-primary" id="btnStartRoutine">
              ì˜¤ëŠ˜ ë£¨í‹´ ì‹œì‘í•˜ê¸°
            </button>
            <button class="btn btn-outline btn-disabled" id="btnEndRoutine">
              ì˜¤ëŠ˜ ë£¨í‹´ ë§ˆë¬´ë¦¬
            </button>
          </div>
        </div>
      </section>

      <!-- ìµœê·¼ 7ì¼ ì¹´ë“œ -->
      <section class="card">
        <div class="card-title">ìµœê·¼ 7ì¼ ìŠ¤ìœ™ ë¦¬í¬íŠ¸</div>
        <p class="card-subtitle">
          ê°„ë‹¨í•œ íë¦„ë§Œ ë¨¼ì € ë³´ì—¬ì£¼ëŠ” v0 í™”ë©´ì…ë‹ˆë‹¤. ì¶”í›„ APIì™€ ê·¸ë˜í”„ë¥¼ ì—°ê²°í•  ì˜ˆì •ì…ë‹ˆë‹¤.
        </p>

        <div class="stat-list" id="recentStatList">
          <!-- JSì—ì„œ ë”ë¯¸ ë°ì´í„° ì±„ì›€ -->
        </div>
      </section>
    </div>

    <!-- í•˜ë‹¨: íŒ¨í„´ ìš”ì•½ / ëŒ€í‘œ ìŠ¤ìœ™ -->
    <div class="bottom-grid">
      <!-- íŒ¨í„´ ìš”ì•½ -->
      <section class="card">
        <div class="card-title">ë‚˜ì˜ íŒ¨í„´ ìš”ì•½ (ë² íƒ€)</div>
        <p class="card-subtitle">
          ìµœê·¼ ìŠ¤ìœ™ì— ìì£¼ ë“±ì¥í•œ AI íƒœê·¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Ianë‹˜ì˜ ê°•ì ê³¼ ì•½ì ì„ ê°„ë‹¨íˆ ì •ë¦¬í•œ ì˜ì—­ì…ë‹ˆë‹¤.
        </p>
        <ul class="pattern-list" id="patternList">
          <!-- JSì—ì„œ ë”ë¯¸ í…ìŠ¤íŠ¸ ì±„ì›€ -->
        </ul>
      </section>

      <!-- ëŒ€í‘œ ìŠ¤ìœ™ -->
      <section class="card">
        <div class="card-title">ìµœê·¼ ëŒ€í‘œ ìŠ¤ìœ™</div>
        <p class="card-subtitle">
          ìµœê·¼ ì—…ë¡œë“œ ì¤‘ ì ìˆ˜ê°€ ë†’ê³  ëŠë‚Œ(feeling)ì´ ì¢‹ì•˜ë˜ ìŠ¤ìœ™ í•˜ë‚˜ë¥¼ ëŒ€í‘œ ìƒ·ìœ¼ë¡œ ì¶”ì²œí•©ë‹ˆë‹¤.
        </p>

        <div class="best-swing" id="bestSwingSection">
          <div class="best-swing-thumb" id="bestSwingThumb">
            <div class="best-swing-thumb-inner">
              <span>ëŒ€í‘œ ìŠ¤ìœ™ ì˜ìƒ ì¸ë„¤ì¼ (ì¶”í›„ API ì—°ê²°)</span>
            </div>
          </div>

          <div class="best-swing-meta">
            <div id="bestSwingTitle">ë“œë¼ì´ë²„ / ì •ë©´ Â· ì ìˆ˜ 72ì </div>
            <div id="bestSwingDate">2025. 11. 29. ì˜¤í›„ 2:41</div>
            <div class="best-swing-tags" id="bestSwingTags">
              <!-- JSì—ì„œ íƒœê·¸ ì±„ì›€ -->
            </div>
          </div>

          <button class="btn btn-outline" id="btnGoBestSwing">
            ëŒ€í‘œ ìŠ¤ìœ™ ìƒì„¸ë³´ê¸°
          </button>
        </div>

        <div class="empty-state" id="noSwingState" style="display:none;">
          ìµœê·¼ ì—…ë¡œë“œëœ ìŠ¤ìœ™ì´ ì—†ìŠµë‹ˆë‹¤.  
          ë¨¼ì € ìŠ¤ìœ™ì„ ì—…ë¡œë“œí•˜ë©´ ì´ ì˜ì—­ì— ëŒ€í‘œ ìŠ¤ìœ™ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
        </div>
      </section>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="/app/js/app.js"></script>
  <script>
  // 1) ë¡œê·¸ì¸ ì²´í¬
  requireLogin();

  // 2) DOM ìºì‹œ
  const focusTagContainer = document.getElementById('focusTagContainer');
  const recentStatList    = document.getElementById('recentStatList');
  const patternList       = document.getElementById('patternList');
  const bestSwingSection  = document.getElementById('bestSwingSection');
  const noSwingState      = document.getElementById('noSwingState');
  const bestSwingTags     = document.getElementById('bestSwingTags');
  const btnStartRoutine   = document.getElementById('btnStartRoutine');
  const btnEndRoutine     = document.getElementById('btnEndRoutine');
  const btnGoBestSwing    = document.getElementById('btnGoBestSwing');
  const bestSwingThumb    = document.getElementById('bestSwingThumb');
  const toastEl           = document.getElementById('toast');

  // 3) í† ìŠ¤íŠ¸
  function showToast(message) {
    if (!toastEl) return;
    toastEl.textContent = message;
    toastEl.classList.add('show');
    setTimeout(() => {
      toastEl.classList.remove('show');
    }, 2000);
  }

  // 4) ë£¨í‹´ ë°ì´í„° ë Œë”ë§
  function renderRoutine(data) {
    const routineDateText  = document.getElementById('routineDateText');
    const routineGoalBadge = document.getElementById('routineGoalBadge');
    const routineMainText  = document.getElementById('routineMainText');

    routineDateText.textContent = data.date_text || 'ì˜¤ëŠ˜ ë£¨í‹´';
    routineGoalBadge.textContent = data.goal_text
      ? `ì˜¤ëŠ˜ ëª©í‘œ Â· ${data.goal_text}`
      : 'ì˜¤ëŠ˜ ëª©í‘œ Â· ê°€ë³ê²Œ ë¦¬ë“¬ ë§Œë“¤ê¸°';

    if (data.patterns && data.patterns.length) {
      routineMainText.textContent = data.patterns[0];
    }

    // í¬ì»¤ìŠ¤ íƒœê·¸
    focusTagContainer.innerHTML = '';
    (data.focus_tags || []).forEach(tag => {
      const span = document.createElement('span');
      span.className = 'focus-tag';
      span.textContent = tag;
      focusTagContainer.appendChild(span);
    });

    // ìµœê·¼ í†µê³„
    recentStatList.innerHTML = '';
    (data.recent_stats || []).forEach(stat => {
      const item = document.createElement('div');
      item.className = 'stat-item';

      const labelRow = document.createElement('div');
      labelRow.className = 'stat-label-row';
      labelRow.innerHTML = `<span>${stat.label}</span><span>${stat.value_text}</span>`;

      const bar  = document.createElement('div');
      bar.className = 'stat-bar';
      const fill = document.createElement('div');
      fill.className = 'stat-bar-fill';
      const r = Math.min(Math.max(stat.ratio || 0, 0), 1);
      fill.style.width = `${r * 100}%`;
      bar.appendChild(fill);

      item.appendChild(labelRow);
      item.appendChild(bar);
      recentStatList.appendChild(item);
    });

    // íŒ¨í„´ ë¦¬ìŠ¤íŠ¸
    patternList.innerHTML = '';
    (data.patterns || []).forEach(text => {
      const li = document.createElement('li');
      li.textContent = text;
      patternList.appendChild(li);
    });

    // ëŒ€í‘œ ìŠ¤ìœ™
    if (!data.best_swing || !data.best_swing.exists) {
      bestSwingSection.style.display = 'none';
      noSwingState.style.display = 'block';
    } else {
      bestSwingSection.style.display = 'flex';
      noSwingState.style.display = 'none';

      const bs = data.best_swing;
      document.getElementById('bestSwingTitle').textContent = bs.title;
      document.getElementById('bestSwingDate').textContent  = bs.date_text;

      bestSwingTags.innerHTML = '';
      (bs.tags || []).forEach(t => {
        const span = document.createElement('span');
        span.className = 'best-swing-tag';
        span.textContent = t;
        bestSwingTags.appendChild(span);
      });

      const goResult = () => {
        window.location.href = `/app/result.html?id=${bs.id}`;
      };
      btnGoBestSwing.onclick = goResult;
      bestSwingThumb.onclick = goResult;
    }
  }

  // 5) ë²„íŠ¼ ìƒíƒœ ë™ê¸°í™” (ë‹¨ì¼ í•¨ìˆ˜)
  function syncRoutineButtons(isActive) {
    if (isActive) {
      // ì§„í–‰ ì¤‘: ì‹œì‘ ë¹„í™œì„±, ë§ˆë¬´ë¦¬ í™œì„±
      btnStartRoutine.classList.add('btn-disabled');
      btnStartRoutine.disabled = true;

      btnEndRoutine.classList.remove('btn-disabled');
      btnEndRoutine.disabled = false;
    } else {
      // ì§„í–‰ ì¤‘ ì•„ë‹˜: ì‹œì‘ í™œì„±, ë§ˆë¬´ë¦¬ ë¹„í™œì„±
      btnStartRoutine.classList.remove('btn-disabled');
      btnStartRoutine.disabled = false;

      btnEndRoutine.classList.add('btn-disabled');
      btnEndRoutine.disabled = true;
    }
  }

  // 6) í˜„ì¬ ë£¨í‹´ ì§„í–‰ ì—¬ë¶€ ì¡°íšŒ
  async function loadRoutineActive() {
    try {
      const res = await apiFetch('/routine/active');
      if (!res.ok) throw new Error('ACTIVE_ROUTINE_FAILED');
      const data = await res.json();
      syncRoutineButtons(!!data.active);
    } catch (err) {
      console.error('ë£¨í‹´ ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', err);
      // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ìƒíƒœ: ì§„í–‰ ì¤‘ ì•„ë‹˜
      syncRoutineButtons(false);
    }
  }

  // 7) ë²„íŠ¼ ì•¡ì…˜ â€“ ì‹¤ì œ API ì—°ë™
  btnStartRoutine.addEventListener('click', async () => {
    try {
      const res = await apiFetch('/routine/start', { method: 'POST' });
      const data = await res.json();

      if (!res.ok || !data.ok) throw new Error(data.message || 'START_ROUTINE_ERROR');

      showToast('ì˜¤ëŠ˜ ë£¨í‹´ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ìŠ¤ìœ™ì„ ì—…ë¡œë“œí•´ ë³¼ê¹Œìš”?');
      syncRoutineButtons(true);

      // ğŸ”¥ ì—…ë¡œë“œ í˜ì´ì§€ë¡œ ì´ë™
      setTimeout(() => {
        window.location.href = '/app/upload.html';
      }, 900);
    } catch (err) {
      console.error('ë£¨í‹´ ì‹œì‘ ì˜¤ë¥˜:', err);
      showToast('ë£¨í‹´ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  });


  btnEndRoutine.addEventListener('click', async () => {
    try {
      const res = await apiFetch('/routine/end', { method: 'POST' });
      const data = await res.json();

      if (!res.ok || !data.ok) {
        throw new Error(data.message || 'END_ROUTINE_ERROR');
      }

      showToast('ì˜¤ëŠ˜ ë£¨í‹´ì„ ë§ˆë¬´ë¦¬í–ˆìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!');
      syncRoutineButtons(false);
    } catch (err) {
      console.error('ë£¨í‹´ ë§ˆë¬´ë¦¬ ì˜¤ë¥˜:', err);
      showToast('ë£¨í‹´ ë§ˆë¬´ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  });

  // 8) ì˜¤ëŠ˜ ë£¨í‹´ ë°ì´í„° ë¡œë“œ
  async function loadRoutine() {
    try {
      const res = await apiFetch('/routine/today');
      if (!res.ok) throw new Error('ROUTINE_TODAY_FAILED');
      const data = await res.json();
      renderRoutine(data);
    } catch (err) {
      console.error('ë£¨í‹´ ë¡œë“œ ì˜¤ë¥˜:', err);
      showToast('ë£¨í‹´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    }
  }

  // 9) ì´ˆê¸° ë¡œë”©
  loadRoutine();
  loadRoutineActive();
</script>



</body>
</html>
