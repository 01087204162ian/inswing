<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ìœ™ ë¶„ì„ ê²°ê³¼ - INSWING</title>
    <link rel="stylesheet" href="/app/css/chat.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e5e7eb;
            min-height: 100vh;
            padding-top: 80px;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.6);
            z-index: 100;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .nav-logo-mark {
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            background: linear-gradient(135deg, #0ea5e9, #22c55e);
            color: #020617;
            font-weight: 800;
            font-size: 0.9rem;
            letter-spacing: 0.14em;
        }

        .nav-logo-text {
            color: #e5e7eb;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 0.05em;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 999px;
            color: #94a3b8;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
            white-space: nowrap; /* í•œê¸€ ë©”ë‰´ ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        .nav-link:hover {
            color: #e5e7eb;
            background: rgba(148, 163, 184, 0.1);
            border-color: rgba(148, 163, 184, 0.3);
        }

        .nav-link.active {
            color: #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
            border-color: rgba(14, 165, 233, 0.3);
        }

        .nav-link.logout {
            color: #f97316;
        }

        .nav-link.logout:hover {
            background: rgba(249, 115, 22, 0.1);
            border-color: rgba(249, 115, 22, 0.3);
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .header {
            margin-bottom: 1.5rem;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #0ea5e9, #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        /* ìƒë‹¨ ë©”íƒ€ ë°°ì§€ */
        .meta-row {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }

        .meta-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.3rem 0.9rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(148, 163, 184, 0.3);
            background: rgba(15, 23, 42, 0.8);
        }

        .meta-badge.club {
            border-color: rgba(14, 165, 233, 0.8);
            color: #0ea5e9;
        }

        .meta-badge.side {
            border-color: rgba(34, 197, 94, 0.8);
            color: #22c55e;
        }

        .meta-badge.score {
            border-color: rgba(251, 191, 36, 0.8);
            color: #facc15;
        }

        .meta-badge.tempo {
            border-color: rgba(59, 130, 246, 0.8);
            color: #60a5fa;
        }

        .content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* ë°ìŠ¤í¬í†±: ì˜ìƒê³¼ ëŠë‚Œ ì„¹ì…˜ì„ ë‚˜ë€íˆ ë°°ì¹˜, AI ì½”ì¹­ì€ ì˜ìƒ ì•„ë˜, ì‹¤ì‹œê°„ ì½”ì¹­ì€ ìš°ì¸¡ */
        @media (min-width: 969px) {
            .content-wrapper {
                display: grid;
                grid-template-columns: 1fr 0.9fr 0.6fr;
                grid-template-rows: auto auto auto;
                gap: 2rem;
            }

            /* ë¹„ë””ì˜¤ ì¹´ë“œ: ì²« ë²ˆì§¸ í–‰, ì²« ë²ˆì§¸ ì—´ */
            .content-wrapper > .card:first-child {
                grid-row: 1;
                grid-column: 1;
            }

            /* AI ë¶„ì„ ì¹´ë“œ: ë‘ ë²ˆì§¸ í–‰, ì²« ë²ˆì§¸ ì—´ (ì˜ìƒ ë°”ë¡œ ì•„ë˜) */
            .content-wrapper > .card:nth-child(2) {
                grid-row: 2;
                grid-column: 1;
            }

            /* ëŠë‚Œ ì„¹ì…˜ ì¹´ë“œ: ì²« ë²ˆì§¸ì™€ ë‘ ë²ˆì§¸ í–‰, ë‘ ë²ˆì§¸ ì—´ (ì˜¤ë¥¸ìª½) */
            .content-wrapper > .card:nth-child(3) {
                grid-row: 1 / 3;
                grid-column: 2;
            }
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .video-container {
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .video-container video {
            width: 100%;
            display: block;
        }

        .metrics-grid-main {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .metrics-grid-extra {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .metric-card {
            background: rgba(15, 23, 42, 0.7);
            padding: 1.1rem 1.2rem;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.25);
        }

        .metric-label {
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 0.35rem;
        }

        .metric-value {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #0ea5e9, #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-unit {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-left: 0.25rem;
        }

        .metric-desc {
            margin-top: 0.35rem;
            font-size: 0.78rem;
            color: #9ca3af;
            line-height: 1.4;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #cbd5e1;
        }

        /* ëŠë‚Œ ì„¹ì…˜ */
        .feeling-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
        }

        .feeling-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }

        .feeling-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-bottom: 0.9rem;
        }

        .feeling-btn {
            padding: 0.9rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(148, 163, 184, 0.3);
            border-radius: 12px;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.25s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .feeling-btn:hover {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.12);
        }

        .feeling-btn.selected {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .feeling-note-label {
            display: block;
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.4rem;
        }

        .feeling-note {
            width: 100%;
            min-height: 70px;
            padding: 0.6rem 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background: rgba(15, 23, 42, 0.7);
            color: #e5e7eb;
            font-size: 0.9rem;
            resize: vertical;
        }

        .feeling-note:focus {
            outline: none;
            border-color: #0ea5e9;
            background: rgba(15, 23, 42, 0.9);
        }

        .feeling-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.6rem;
        }

        .btn-feeling-save {
            padding: 0.55rem 1.2rem;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            background: linear-gradient(135deg, #0ea5e9, #22c55e);
            color: #020617;
            transition: all 0.2s;
        }

        .btn-feeling-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.35);
        }

        .feeling-status-text {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .feeling-status-text.saved {
            color: #4ade80;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
            border: none;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9, #22c55e);
            color: #020617;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.4);
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.2);
            color: #e5e7eb;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.3);
        }

        .loading {
            text-align: center;
            padding: 4rem;
            color: #94a3b8;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* AI ì½”ë©˜íŠ¸ í‚¤ì›Œë“œ íƒœê·¸ */
        /* AI ì½”ì¹­ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .ai-coaching-card {
            margin-bottom: 1.5rem;
            padding: 1.2rem;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(96, 165, 250, 0.5);
            position: relative;
        }

        .ai-coaching-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .ai-coaching-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(34, 197, 94, 0.2));
            border: 1px solid rgba(96, 165, 250, 0.4);
        }

        .ai-badge-icon {
            font-size: 1rem;
        }

        .ai-badge-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: #60a5fa;
        }

        .regenerate-btn {
            padding: 0.4rem 0.6rem;
            border-radius: 8px;
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.3);
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .regenerate-btn:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: rgba(96, 165, 250, 0.5);
            transform: rotate(180deg);
        }

        .regenerate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .ai-comment-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e5e7eb;
            min-height: 3rem;
        }

        .loading-dots {
            color: #94a3b8;
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .ai-keywords {
            margin-top: 0.8rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .ai-keyword-badge {
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            border: 1px solid rgba(96, 165, 250, 0.6);
            color: #bfdbfe;
            background: rgba(15, 23, 42, 0.9);
        }

        /* ì§ˆë¬¸í˜• ì½”ì¹­ ìŠ¤íƒ€ì¼ */
        .coaching-question-box {
            margin-top: 0.5rem;
            padding: 0.9rem 1rem;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .coaching-question-input {
            width: 100%;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            background: rgba(15, 23, 42, 0.8);
            color: #e5e7eb;
            font-size: 0.9rem;
            padding: 0.6rem 0.75rem;
            resize: vertical;
        }

        .coaching-question-input:focus {
            outline: none;
            border-color: #0ea5e9;
            background: rgba(15, 23, 42, 0.95);
        }

        .coaching-question-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.6rem;
        }

        .coaching-answer-box {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #e5e7eb;
            padding: 0.75rem 0.8rem;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(96, 165, 250, 0.4);
            white-space: pre-wrap;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            left: 50%;
            bottom: 24px;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.95);
            border-radius: 999px;
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
            color: #e5e7eb;
            border: 1px solid rgba(52, 211, 153, 0.7);
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.7);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease-out, transform 0.25s ease-out;
            z-index: 200;
        }

        .toast.show {
            opacity: 1;
            transform: translate(-50%, -6px);
        }

        @media (max-width: 968px) {
            .content-wrapper {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }
        }

        /* ì‹¤ì‹œê°„ ì½”ì¹­ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .realtime-coaching-panel {
            background: rgba(30, 41, 59, 0.95);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            display: flex;
            flex-direction: column;
            height: 100%;
            max-height: 600px;
        }

        .realtime-coaching-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .realtime-coaching-title {
            font-size: 1rem;
            font-weight: 600;
            color: #cbd5e1;
        }

        .realtime-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
        }

        .realtime-status.status-joined,
        .realtime-status.status-connected {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .realtime-status.status-error,
        .realtime-status.status-timeout {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .realtime-message-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            min-height: 200px;
        }

        .realtime-message {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            max-width: 80%;
            word-wrap: break-word;
        }

        .realtime-message.message-golfer {
            align-self: flex-end;
            align-items: flex-end;
        }

        .realtime-message.message-coach {
            align-self: flex-start;
            align-items: flex-start;
        }

        .message-text {
            padding: 0.6rem 0.9rem;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .message-golfer .message-text {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.3), rgba(59, 130, 246, 0.3));
            border: 1px solid rgba(59, 130, 246, 0.5);
            color: #bfdbfe;
        }

        .message-coach .message-text {
            background: rgba(148, 163, 184, 0.2);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #cbd5e1;
        }

        .message-time {
            font-size: 0.7rem;
            color: #64748b;
            padding: 0 0.5rem;
        }

        .realtime-input-area {
            padding: 1rem;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
            display: flex;
            gap: 0.5rem;
        }

        .realtime-message-input {
            flex: 1;
            padding: 0.6rem 0.9rem;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            background: rgba(15, 23, 42, 0.7);
            color: #e5e7eb;
            font-size: 0.9rem;
        }

        .realtime-message-input:focus {
            outline: none;
            border-color: #0ea5e9;
            background: rgba(15, 23, 42, 0.9);
        }

        .realtime-message-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .realtime-send-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #0ea5e9, #22c55e);
            color: #020617;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .realtime-send-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }

        .realtime-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* íƒœë¸”ë¦¿ í¬ê¸° (769px ~ 968px) */
        @media (min-width: 769px) and (max-width: 968px) {
            .content-wrapper {
                grid-template-columns: 1fr 0.6fr;
            }

            .realtime-coaching-wrapper {
                grid-row: 3;
                grid-column: 1 / 3;
            }
        }

        /* ë°ìŠ¤í¬í†±: ìš°ì¸¡ ì‚¬ì´ë“œë°” (969px ì´ìƒ) */
        @media (min-width: 969px) {
            .realtime-coaching-wrapper {
                grid-row: 1 / 3;
                grid-column: 3;
            }
        }

        /* ëª¨ë°”ì¼: í•˜ë‹¨ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ */
        @media (max-width: 768px) {
            .realtime-coaching-wrapper {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 150;
                max-height: 50vh;
                border-radius: 16px 16px 0 0;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
                transform: translateY(calc(100% - 60px));
                transition: transform 0.3s ease-out;
            }

            .realtime-coaching-wrapper.expanded {
                transform: translateY(0);
            }

            .realtime-coaching-header {
                cursor: pointer;
            }

            .realtime-coaching-panel {
                max-height: 50vh;
            }

            body {
                padding-bottom: 60px;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì§ˆë¬¸ ë°•ìŠ¤ ì—¬ë°± ì¡°ì • */
            .coaching-question-box {
                padding: 0.8rem 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .top-nav {
                height: 56px;
                padding: 0 0.75rem;
                overflow-x: auto; /* ë„ˆë¬´ ì¢ìœ¼ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ë¡œ ì²˜ë¦¬ */
            }

            body {
                padding-top: 72px;
            }

            .nav-logo-text {
                display: none;
            }

            .nav-menu {
                gap: 0.3rem;
                flex-wrap: nowrap; /* ì¤„ë°”ê¿ˆ ì—†ì´ í•œ ì¤„ ìœ ì§€ */
            }

            .nav-link {
                padding: 0.35rem 0.65rem;
                font-size: 0.78rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 1.5rem;
            }

            .metrics-grid-main,
            .metrics-grid-extra {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="top-nav">
        <a href="/ko/index.html" class="nav-logo">
            <span class="nav-logo-mark">INS</span>
            <span class="nav-logo-text">WING</span>
        </a>
        <div class="nav-menu">
            <a href="/app/upload.html" class="nav-link">ì—…ë¡œë“œ</a>
            <a href="/app/history.html" class="nav-link active">íˆìŠ¤í† ë¦¬</a>
            <a href="/app/training.html" class="nav-link">íŠ¸ë ˆì´ë‹</a>
            <a href="/app/routine.html" class="nav-link">ë£¨í‹´</a>
            <a href="#" onclick="logout(); return false;" class="nav-link logout">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container">
        <div class="header">
            <h1>ìŠ¤ìœ™ ë¶„ì„ ê²°ê³¼</h1>
            <p class="subtitle" id="swingDate">ë¶„ì„ ì¼ì‹œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            <div class="meta-row">
                <span class="meta-badge club" id="metaClub">í´ëŸ½</span>
                <span class="meta-badge side" id="metaSide">ë°©í–¥</span>
                <span class="meta-badge score" id="metaScore">ì¢…í•© ì ìˆ˜ -</span>
                <span class="meta-badge tempo" id="metaTempo">í…œí¬ -</span>
            </div>
        </div>

        <div id="loadingDiv" class="loading">
            ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘
        </div>

        <div id="contentDiv" class="content-wrapper" style="display:none;">
            <!-- ë¹„ë””ì˜¤ ì„¹ì…˜ -->
            <div class="card">
                <div class="video-container">
                    <video id="swingVideo" controls></video>
                </div>
            </div>

            <!-- AI ë¶„ì„ ì§€í‘œ & ì½”ë©˜íŠ¸ ì„¹ì…˜ (ì˜ìƒ ë°”ë¡œ ì•„ë˜) -->
            <div class="card">
                <h2 style="margin-bottom: 1rem; color: #cbd5e1;">AI ë¶„ì„ ì§€í‘œ & ì½”ë©˜íŠ¸</h2>

                <!-- AI ì½”ì¹­ ì¹´ë“œ -->
                <div class="ai-coaching-card" id="aiCoachingCard">
                    <div class="ai-coaching-header">
                        <div class="ai-coaching-badge">
                            <span class="ai-badge-icon">ğŸ¤–</span>
                            <span class="ai-badge-text">Claude AI ì½”ì¹­</span>
                        </div>
                        <button class="regenerate-btn" id="regenerateBtn" style="display:none;" title="ì½”ì¹­ ë‹¤ì‹œ ìƒì„±">
                            <span>ğŸ”„</span>
                        </button>
                    </div>
                    <div id="aiCommentBox" class="ai-comment-content">
                        <div class="loading-dots">ë¶„ì„ ì½”ë©˜íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘</div>
                    </div>
                    <div id="aiKeywords" class="ai-keywords"></div>

                    <!-- ì§ˆë¬¸í˜• ì½”ì¹­ ì„¹ì…˜ -->
                    <div class="section-title" style="margin-top: 1.4rem;">ì´ ìŠ¤ìœ™ì— ëŒ€í•´ ì§ì ‘ ì§ˆë¬¸í•´ ë³´ì„¸ìš”</div>
                    <div class="coaching-question-box">
                        <textarea
                            id="coachingQuestionInput"
                            class="coaching-question-input"
                            rows="2"
                            placeholder="ì˜ˆ: í”¼ë‹ˆì‹œì—ì„œ ìê¾¸ ì™¼ìª½ìœ¼ë¡œ ë„˜ì–´ê°€ìš”. ì–´ë–»ê²Œ ì¡ì•„ì•¼ í• ê¹Œìš”?"
                        ></textarea>
                        <div class="coaching-question-actions">
                            <button id="coachingQuestionBtn" class="btn-feeling-save">
                                ì´ ìŠ¤ìœ™ì— ëŒ€í•´ ì§ˆë¬¸í•˜ê¸°
                            </button>
                            <span id="coachingQuestionStatus" class="feeling-status-text"></span>
                        </div>
                        <div id="coachingAnswerBox" class="coaching-answer-box" style="margin-top: 0.8rem;"></div>
                    </div>
                </div>

                <!-- ì£¼ìš” ì§€í‘œ 4ê°œ -->
                <div class="metrics-grid-main">
                    <div class="metric-card">
                        <div class="metric-label">ë°±ìŠ¤ìœ™ ê°ë„</div>
                        <div class="metric-value">
                            <span id="backswingAngle">-</span><span class="metric-unit">Â°</span>
                        </div>
                        <div class="metric-desc">
                            ì–´ê¹¨â€“íŒ”â€“ì†ëª©ì˜ ìµœëŒ€ ê°ë„ì…ë‹ˆë‹¤.  
                            90Â° ì „í›„ëŠ” ì»¨íŠ¸ë¡¤ ìœ„ì£¼, 170Â° ì´ìƒì€ í° ì•„í¬ë¡œ ë¹„ê±°ë¦¬ë¥¼ ë…¸ë¦¬ëŠ” ìŠ¤ìœ™ì…ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ì„íŒ©íŠ¸ ì†ë„</div>
                        <div class="metric-value">
                            <span id="impactSpeed">-</span>
                        </div>
                        <div class="metric-desc">
                            ì†ëª© ì´ë™ ì†ë„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìƒëŒ€ì ì¸ ì„íŒ©íŠ¸ ìŠ¤í”¼ë“œì…ë‹ˆë‹¤.  
                            ê°’ì´ ë†’ì„ìˆ˜ë¡ ì—ë„ˆì§€ë¥¼ ë§ì´ ì „ë‹¬í•œ ìŠ¤ìœ™ì…ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">íŒ”ë¡œìš°ìŠ¤ë£¨ ê°ë„</div>
                        <div class="metric-value">
                            <span id="followThroughAngle">-</span><span class="metric-unit">Â°</span>
                        </div>
                        <div class="metric-desc">
                            ì„íŒ©íŠ¸ ì´í›„ ëª¸ê³¼ íŒ”ì´ íšŒì „í•œ ë²”ìœ„ì…ë‹ˆë‹¤.  
                            ì¶©ë¶„í•œ íŒ”ë¡œìš°ìŠ¤ë£¨ëŠ” ë°©í–¥ì„±ê³¼ íƒ„ë„ì— ë„ì›€ì„ ì¤ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ë°¸ëŸ°ìŠ¤ ì ìˆ˜</div>
                        <div class="metric-value">
                            <span id="balanceScore">-</span>
                        </div>
                        <div class="metric-desc">
                            ì„íŒ©íŠ¸ ì „í›„ ê³¨ë°˜ ìˆ˜í‰ ìœ ì§€ ì •ë„ì…ë‹ˆë‹¤.  
                            1.0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì²´ì¤‘ ì´ë™ê³¼ ê· í˜•ì´ ì•ˆì •ì ì¸ ìŠ¤ìœ™ì…ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>

                <!-- ì¶”ê°€ ë¶„ì„ ì§€í‘œ -->
                <div class="section-title">ì¶”ê°€ ë¶„ì„ ì§€í‘œ</div>
                <div class="metrics-grid-extra">
                    <div class="metric-card">
                        <div class="metric-label">í…œí¬ ë¹„ìœ¨ (ë°±:ë‹¤ìš´)</div>
                        <div class="metric-value">
                            <span id="tempoRatio">-</span>
                        </div>
                        <div class="metric-desc">
                            ë°±ìŠ¤ìœ™ ì‹œê°„ê³¼ ë‹¤ìš´ìŠ¤ìœ™ ì‹œê°„ì˜ ë¹„ìœ¨ì…ë‹ˆë‹¤.  
                            ì´ë¡ ì ìœ¼ë¡œëŠ” 3:1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ë¦¬ë“¬ì´ ì¢‹ì€ ìŠ¤ìœ™ìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ë°±ìŠ¤ìœ™ ì‹œê°„</div>
                        <div class="metric-value">
                            <span id="backswingTime">-</span><span class="metric-unit">s</span>
                        </div>
                        <div class="metric-desc">
                            ì–´ë“œë ˆìŠ¤ë¶€í„° ë°±ìŠ¤ìœ™ íƒ‘ê¹Œì§€ ê±¸ë¦° ì‹œê°„ì…ë‹ˆë‹¤.  
                            ë³¸ì¸ë§Œì˜ ì¼ì •í•œ ë¦¬ë“¬ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ë‹¤ìš´ìŠ¤ìœ™ ì‹œê°„</div>
                        <div class="metric-value">
                            <span id="downswingTime">-</span><span class="metric-unit">s</span>
                        </div>
                        <div class="metric-desc">
                            ë°±ìŠ¤ìœ™ íƒ‘ì—ì„œ ì„íŒ©íŠ¸ê¹Œì§€ì˜ ì‹œê°„ì…ë‹ˆë‹¤.  
                            ë„ˆë¬´ ë¹ ë¥´ë©´ ê¸‰í•œ ìŠ¤ìœ™, ë„ˆë¬´ ëŠë¦¬ë©´ í˜ì´ ë¹ ì§€ëŠ” ìŠ¤ìœ™ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ë¨¸ë¦¬ í”ë“¤ë¦¼</div>
                        <div class="metric-value">
                            <span id="headMovement">-</span><span class="metric-unit">%</span>
                        </div>
                        <div class="metric-desc">
                            ìŠ¤ìœ™ ë™ì•ˆ ë¨¸ë¦¬ ìœ„ì¹˜ ë³€í™”ë¥¼ ë¹„ìœ¨ë¡œ í‘œí˜„í•œ ê°’ì…ë‹ˆë‹¤.  
                            ê°’ì´ ë‚®ì„ìˆ˜ë¡ ìƒì²´ê°€ ê³ ì •ë˜ì–´ ë³´ë‹¤ ì•ˆì •ì ì¸ ì„íŒ©íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ì–´ê¹¨ íšŒì „ ë²”ìœ„</div>
                        <div class="metric-value">
                            <span id="shoulderRange">-</span><span class="metric-unit">Â°</span>
                        </div>
                        <div class="metric-desc">
                            ìŠ¤ìœ™ ì¤‘ ì–´ê¹¨ê°€ íšŒì „í•œ ì „ì²´ ê°ë„ì…ë‹ˆë‹¤.  
                            ì¶©ë¶„í•œ íšŒì „ì€ ë¹„ê±°ë¦¬ í–¥ìƒì—, ì§€ë‚˜ì¹œ íšŒì „ì€ ë°©í–¥ì„±ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ê³¨ë°˜ íšŒì „ ë²”ìœ„</div>
                        <div class="metric-value">
                            <span id="hipRange">-</span><span class="metric-unit">Â°</span>
                        </div>
                        <div class="metric-desc">
                            ê³¨ë°˜ì˜ íšŒì „ ê°ë„ì…ë‹ˆë‹¤.  
                            í•˜ì²´ ë¦¬ë“œê°€ ì˜ ë˜ë©´ ê³¨ë°˜â†’ëª¸í†µâ†’íŒ” ìˆœì„œì˜ ì²´ì¸ ë¦¬ì•¡ì…˜ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">íšŒì „ íš¨ìœ¨</div>
                        <div class="metric-value">
                            <span id="rotationEfficiency">-</span>
                        </div>
                        <div class="metric-desc">
                            ìƒì²´ì™€ í•˜ì²´ íšŒì „ì˜ ì¡°í™”ë¥¼ 0~100 ì ìˆ˜ë¡œ í‘œí˜„í•œ ê°’ì…ë‹ˆë‹¤.  
                            ìˆ«ìê°€ ë†’ì„ìˆ˜ë¡ í˜ ì „ë‹¬ì´ íš¨ìœ¨ì ì¸ ìŠ¤ìœ™ì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">ì¢…í•© ìŠ¤ìœ™ ì ìˆ˜</div>
                        <div class="metric-value">
                            <span id="overallScore">-</span>
                        </div>
                        <div class="metric-desc">
                            ì—¬ëŸ¬ ì§€í‘œë¥¼ ì¢…í•©í•œ 0~100 ì ìˆ˜ì…ë‹ˆë‹¤.  
                            ì ˆëŒ€ í‰ê°€ë¼ê¸°ë³´ë‹¤ëŠ”, ë‚´ ìŠ¤ìœ™ì´ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ë¹„êµí•˜ëŠ” ìš©ë„ë¡œ í™œìš©í•´ë³´ì„¸ìš”.
                        </div>
                    </div>
                </div>
            </div>

            <!-- ëŠë‚Œ ì„¹ì…˜ -->
            <div class="card">
                <div class="feeling-section">
                    <div class="feeling-title">ì˜¤ëŠ˜ ì´ ìŠ¤ìœ™ì€ ì–´ë–»ê²Œ ëŠê»´ì¡Œë‚˜ìš”?</div>
                    <div class="feeling-options">
                        <button class="feeling-btn" data-feeling="perfect">ì™„ë²½í–ˆì–´ìš”</button>
                        <button class="feeling-btn" data-feeling="good">ê´œì°®ì•˜ì–´ìš”</button>
                        <button class="feeling-btn" data-feeling="normal">ë³´í†µì´ì—ìš”</button>
                        <button class="feeling-btn" data-feeling="bad">ì•„ì‰¬ì› ì–´ìš”</button>
                    </div>

                    <label for="feelingNote" class="feeling-note-label">
                        ê°„ë‹¨ ë©”ëª¨ (ì„ íƒ) â€“ ì˜¤ëŠ˜ ìŠ¤ìœ™ì— ëŒ€í•œ ìì‹ ì˜ ëŠë‚Œì„ ì ì–´ë³´ì„¸ìš”.
                    </label>
                    <textarea id="feelingNote" class="feeling-note" placeholder="ì˜ˆ: ë“œë¼ì´ë²„ëŠ” ì¢‹ì•˜ëŠ”ë°, ì–´í”„ë¡œì¹˜ ë•Œë¬¸ì— ìŠ¤ì½”ì–´ê°€ ì•„ì‰¬ì› ë‹¤."></textarea>

                    <div class="feeling-actions">
                        <button id="saveFeelingBtn" class="btn-feeling-save">ëŠë‚Œ ì €ì¥</button>
                        <span id="feelingSaveStatus" class="feeling-status-text"></span>
                    </div>
                </div>

                <div class="actions">
                    <a href="/app/upload.html" class="btn btn-primary">ìƒˆ ìŠ¤ìœ™ ì—…ë¡œë“œ</a>
                    <a id="openTrainingBtn" href="#" class="btn btn-secondary">ì´ ìŠ¤ìœ™ìœ¼ë¡œ íŠ¸ë ˆì´ë‹ ì—´ê¸°</a>
                    <a href="/app/history.html" class="btn btn-secondary">íˆìŠ¤í† ë¦¬ ë³´ê¸°</a>
                </div>
            </div>

            <!-- ì‹¤ì‹œê°„ ì½”ì¹­ íŒ¨ë„ (ë°ìŠ¤í¬í†±: ìš°ì¸¡ ì‚¬ì´ë“œë°”) -->
            <div class="realtime-coaching-wrapper">
                <div class="realtime-coaching-panel">
                    <div class="realtime-coaching-header" id="realtimeHeader">
                        <div class="realtime-coaching-title">ì‹¤ì‹œê°„ ì½”ì¹­</div>
                        <div class="realtime-status" id="realtimeStatus">ì—°ê²° ì¤‘...</div>
                    </div>
                    <div class="realtime-message-list" id="realtimeMessageList">
                        <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="realtime-input-area">
                        <input 
                            type="text" 
                            id="realtimeMessageInput" 
                            class="realtime-message-input" 
                            placeholder="ì—°ê²° ì¤‘..."
                            disabled
                        />
                        <button id="realtimeSendBtn" class="realtime-send-btn" disabled>ì „ì†¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div id="toast" class="toast"></div>

    <!-- Phoenix Socket ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/phoenix@1.7.0/priv/static/phoenix.min.js"></script>
    <script src="/app/js/app.js"></script>
    <script src="/app/js/result.js"></script>
    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        requireLogin();

        const loadingDiv = document.getElementById('loadingDiv');
        const contentDiv = document.getElementById('contentDiv');
        const swingVideo = document.getElementById('swingVideo');
        const swingDateEl = document.getElementById('swingDate');

        const metaClub = document.getElementById('metaClub');
        const metaSide = document.getElementById('metaSide');
        const metaScore = document.getElementById('metaScore');
        const metaTempo = document.getElementById('metaTempo');

        const aiCommentBox = document.getElementById('aiCommentBox');
        const aiKeywordsEl = document.getElementById('aiKeywords');

        const feelingNoteEl = document.getElementById('feelingNote');
        const saveFeelingBtn = document.getElementById('saveFeelingBtn');
        const feelingStatusEl = document.getElementById('feelingSaveStatus');
        const toastEl = document.getElementById('toast');

        const swingId = getQueryParam('id');

        if (!swingId) {
            alert('ìŠ¤ìœ™ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            window.location.href = '/app/history.html';
        }

        const trainingBtn = document.getElementById('openTrainingBtn');
        if (trainingBtn && swingId) {
            trainingBtn.href = `/app/training.html?id=${encodeURIComponent(swingId)}`;
        }

        const clubNames = {
            driver: 'ë“œë¼ì´ë²„',
            wood: 'ìš°ë“œ',
            iron: 'ì•„ì´ì–¸',
            wedge: 'ì›¨ì§€',
            putter: 'í¼í„°'
        };

        const sideNames = {
            front: 'ì •ë©´',
            side: 'ì¸¡ë©´',
            back: 'í›„ë©´'
        };

        function safeNumber(value, fixed) {
            if (value === null || value === undefined) return '-';
            const num = Number(value);
            if (Number.isNaN(num)) return '-';
            return typeof fixed === 'number' ? num.toFixed(fixed) : String(num);
        }

        function showToast(message) {
            if (!toastEl) return;
            toastEl.textContent = message;
            toastEl.classList.add('show');
            setTimeout(() => {
                toastEl.classList.remove('show');
            }, 2200);
        }

        function extractKeywordsFromComment(comment) {
            if (!comment || typeof comment !== 'string') return [];

            const keywords = [];

            if (comment.includes('ë°¸ëŸ°ìŠ¤')) keywords.push('ë°¸ëŸ°ìŠ¤');
            if (comment.includes('ë¨¸ë¦¬')) keywords.push('ë¨¸ë¦¬ ê³ ì •');
            if (comment.includes('í…œí¬')) keywords.push('í…œí¬');
            if (comment.includes('íšŒì „')) keywords.push('íšŒì „');
            if (comment.includes('ë¹„ê±°ë¦¬')) keywords.push('ë¹„ê±°ë¦¬');
            if (comment.includes('ë¶ˆì•ˆ')) keywords.push('ì•ˆì •ê°');
            if (comment.includes('ì²´ì¤‘ ì´ë™')) keywords.push('ì²´ì¤‘ ì´ë™');
            if (comment.includes('íŒŒì›Œ')) keywords.push('íŒŒì›Œí˜• ìŠ¤ìœ™');

            // ì¤‘ë³µ ì œê±°
            return [...new Set(keywords)];
        }

        // íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
        function typeText(element, text, callback) {
            element.innerHTML = '';
            let index = 0;
            const speed = 20; // íƒ€ì´í•‘ ì†ë„ (ms)

            function type() {
                if (index < text.length) {
                    element.textContent = text.substring(0, index + 1);
                    index++;
                    setTimeout(type, speed);
                } else {
                    if (callback) callback();
                }
            }

            type();
        }

        // ì½”ì¹­ ë‹¤ì‹œ ìƒì„± í•¨ìˆ˜
        async function regenerateCoaching() {
            const regenerateBtn = document.getElementById('regenerateBtn');
            const aiCommentBox = document.getElementById('aiCommentBox');
            const aiKeywordsEl = document.getElementById('aiKeywords');

            if (!swingId) {
                showToast('ìŠ¤ìœ™ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            regenerateBtn.disabled = true;
            aiCommentBox.innerHTML = '<div class="loading-dots">ìƒˆë¡œìš´ ì½”ì¹­ì„ ìƒì„±í•˜ëŠ” ì¤‘</div>';
            aiKeywordsEl.innerHTML = '';

            try {
                const response = await apiFetch(`/swings/${swingId}/regenerate-coaching`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error('ì½”ì¹­ ì¬ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const data = await response.json();
                if (data && data.coaching) {
                    typeText(aiCommentBox, data.coaching, () => {
                        const keywords = extractKeywordsFromComment(data.coaching);
                        if (keywords.length > 0) {
                            keywords.forEach(k => {
                                const span = document.createElement('span');
                                span.className = 'ai-keyword-badge';
                                span.textContent = k;
                                aiKeywordsEl.appendChild(span);
                            });
                        }
                        showToast('ìƒˆë¡œìš´ ì½”ì¹­ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    });
                } else {
                    throw new Error('ì½”ì¹­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì½”ì¹­ ì¬ìƒì„± ì˜¤ë¥˜:', error);
                aiCommentBox.innerHTML = '<div style="color: #f87171;">ì½”ì¹­ ì¬ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
                showToast('ì½”ì¹­ ì¬ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                regenerateBtn.disabled = false;
            }
        }

        // ë‹¤ì‹œ ìƒì„± ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('regenerateBtn')?.addEventListener('click', regenerateCoaching);

        // ë¶„ì„ ê²°ê³¼ ë¡œë“œ
        async function loadResult() {
            try {
                console.log('[Result] ìŠ¤ìœ™ ë°ì´í„° ë¡œë“œ ì‹œì‘, swingId:', swingId);
                console.log('[Result] User Agent:', navigator.userAgent);
                console.log('[Result] ëª¨ë°”ì¼ ì—¬ë¶€:', /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent));
                
                const response = await apiFetch(`/swings/${swingId}`);
                console.log('[Result] API ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('[Result] API ì˜¤ë¥˜ ì‘ë‹µ:', response.status, errorText);
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${errorText || 'ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}`);
                }

                const data = await response.json();
                console.log('[Result] ë°ì´í„° ë¡œë“œ ì„±ê³µ:', Object.keys(data));
                const { swing, metrics, feeling, comment } = data;

                loadingDiv.style.display = 'none';
                contentDiv.style.display = 'grid';

                // ë¹„ë””ì˜¤
                swingVideo.src = swing.video_url;

                // ë‚ ì§œ
                const date = new Date(swing.created_at);
                swingDateEl.textContent = date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                // ìƒë‹¨ ë©”íƒ€
                metaClub.textContent = clubNames[swing.club_type] || swing.club_type || 'í´ëŸ½';
                metaSide.textContent = sideNames[swing.shot_side] || swing.shot_side || 'ë°©í–¥';

                const tempoText = safeNumber(metrics?.tempo_ratio, 2);
                const overallText = safeNumber(metrics?.overall_score, 0);

                metaTempo.textContent = `í…œí¬ ${tempoText === '-' ? '-' : tempoText}`;
                metaScore.textContent = `ì¢…í•© ${overallText === '-' ? '-' : overallText}ì `;

                // AI ì½”ë©˜íŠ¸ (íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜)
                const regenerateBtn = document.getElementById('regenerateBtn');
                if (comment) {
                    regenerateBtn.style.display = 'block';
                    typeText(aiCommentBox, comment, () => {
                        const keywords = extractKeywordsFromComment(comment);
                        aiKeywordsEl.innerHTML = '';
                        if (keywords.length > 0) {
                            keywords.forEach(k => {
                                const span = document.createElement('span');
                                span.className = 'ai-keyword-badge';
                                span.textContent = k;
                                aiKeywordsEl.appendChild(span);
                            });
                        }
                    });
                } else {
                    regenerateBtn.style.display = 'none';
                    aiCommentBox.innerHTML = '<div class="loading-dots">ì´ë²ˆ ìŠ¤ìœ™ì— ëŒ€í•œ ì½”ë©˜íŠ¸ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ìŒ ìŠ¤ìœ™ë¶€í„° ë°ì´í„°ë¥¼ ë” ìŒ“ì•„ë³¼ê²Œìš”.</div>';
                    aiKeywordsEl.innerHTML = '';
                }

                // ì£¼ìš” ì§€í‘œ 4ê°œ
                if (metrics) {
                    document.getElementById('backswingAngle').textContent = safeNumber(metrics.backswing_angle, 1);
                    document.getElementById('impactSpeed').textContent = safeNumber(metrics.impact_speed, 2);
                    document.getElementById('followThroughAngle').textContent = safeNumber(metrics.follow_through_angle, 1);
                    document.getElementById('balanceScore').textContent = safeNumber(metrics.balance_score, 2);

                    // ì¶”ê°€ ì§€í‘œ
                    document.getElementById('tempoRatio').textContent = safeNumber(metrics.tempo_ratio, 2);
                    document.getElementById('backswingTime').textContent = safeNumber(metrics.backswing_time_sec, 2);
                    document.getElementById('downswingTime').textContent = safeNumber(metrics.downswing_time_sec, 2);
                    document.getElementById('headMovement').textContent = safeNumber(metrics.head_movement_pct, 2);
                    document.getElementById('shoulderRange').textContent = safeNumber(metrics.shoulder_rotation_range, 1);
                    document.getElementById('hipRange').textContent = safeNumber(metrics.hip_rotation_range, 1);
                    document.getElementById('rotationEfficiency').textContent = safeNumber(metrics.rotation_efficiency, 0);
                    document.getElementById('overallScore').textContent = overallText;
                }

                // ëŠë‚Œ/ë©”ëª¨ ì´ˆê¸° ì„¤ì •
                setupFeelingSection(feeling || null);

            } catch (error) {
                console.error('ê²°ê³¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                
                // ìƒì„¸í•œ ì˜¤ë¥˜ ì •ë³´ ë¡œê¹…
                if (error.message) {
                    console.error('ì˜¤ë¥˜ ë©”ì‹œì§€:', error.message);
                }
                if (error.stack) {
                    console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                }
                
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì¸ì§€ í™•ì¸
                const isNetworkError = error.message && (
                    error.message.includes('Failed to fetch') ||
                    error.message.includes('NetworkError') ||
                    error.message.includes('network') ||
                    error.name === 'TypeError'
                );
                
                const errorMessage = isNetworkError 
                    ? 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì¸í„°ë„· ì—°ê²°ì´ ë¶ˆì•ˆì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                    : (error.message || 'ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                
                // ë¡œë”© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                loadingDiv.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <p style="color: #f87171; margin-bottom: 1rem; font-size: 1.1rem;">
                            ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
                        </p>
                        <p style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 1.5rem; line-height: 1.6;">
                            ${errorMessage}
                        </p>
                        <button onclick="location.reload()" style="
                            padding: 0.75rem 1.5rem;
                            background: linear-gradient(135deg, #0ea5e9, #22c55e);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            font-size: 0.95rem;
                            min-width: 120px;
                        ">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                `;
                
                // ëª¨ë°”ì¼ì—ì„œë„ ì•Œë¦¼ í‘œì‹œ
                showToast('ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        let currentFeelingCode = null;

        // ëŠë‚Œ ì„¹ì…˜ ì„¤ì •
        function setupFeelingSection(feeling) {
            const buttons = document.querySelectorAll('.feeling-btn');

            currentFeelingCode = feeling?.feeling_code || null;
            const initialNote = feeling?.note || '';

            // ì´ˆê¸° ë…¸íŠ¸
            feelingNoteEl.value = initialNote || '';

            // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ
            buttons.forEach(btn => {
                const code = btn.dataset.feeling;
                if (!code) return;
                if (code === currentFeelingCode) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }

                btn.addEventListener('click', () => {
                    buttons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    currentFeelingCode = code;
                });
            });

            // ì €ì¥ ë²„íŠ¼
            saveFeelingBtn.addEventListener('click', async () => {
                if (!currentFeelingCode) {
                    alert('ë¨¼ì € ëŠë‚Œ ë²„íŠ¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
                    return;
                }

                const note = feelingNoteEl.value || '';

                try {
                    feelingStatusEl.textContent = 'ì €ì¥ ì¤‘...';
                    feelingStatusEl.classList.remove('saved');

                    const response = await apiFetch(`/swings/${swingId}/feeling`, {
                        method: 'POST',
                        body: JSON.stringify({
                            feeling_code: currentFeelingCode,
                            note: note
                        })
                    });

                    if (!response.ok) {
                        console.error('ëŠë‚Œ ì €ì¥ ì‹¤íŒ¨');
                        feelingStatusEl.textContent = 'ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
                        return;
                    }

                    feelingStatusEl.textContent = 'ì˜¤ëŠ˜ ìŠ¤ìœ™ ëŠë‚Œì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    feelingStatusEl.classList.add('saved');
                    showToast('ì˜¤ëŠ˜ ìŠ¤ìœ™ ëŠë‚Œì„ ì €ì¥í–ˆì–´ìš” âœ…');

                } catch (error) {
                    console.error('ëŠë‚Œ ì €ì¥ ì˜¤ë¥˜:', error);
                    feelingStatusEl.textContent = 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }
            });
        }

        loadResult();
        
    </script>
</body>
</html>
