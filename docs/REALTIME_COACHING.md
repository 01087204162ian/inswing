# REALTIME_COACHING

> **ëª©ì **: INSWING ì‹¤ì‹œê°„ ì½”ì¹­ ì‹œìŠ¤í…œì˜ êµ¬ì¡°, WebSocket/Phoenix ì´ë²¤íŠ¸ ê·œê²©, í´ë¼ì´ì–¸íŠ¸Â·ì„œë²„ ë™ì‘ íë¦„ ë° í™•ì¥ ê¸°ì¤€ì„ ë¬¸ì„œí™”í•œë‹¤.

> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-01

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ êµ¬ì¡°](#ì‹¤ì‹œê°„-ì‹œìŠ¤í…œ-êµ¬ì¡°)
3. [ì´ë²¤íŠ¸ ê·œê²©](#ì´ë²¤íŠ¸-ê·œê²©)
4. [í´ë¼ì´ì–¸íŠ¸ ë™ì‘](#í´ë¼ì´ì–¸íŠ¸-ë™ì‘)
5. [ì„œë²„ ë™ì‘](#ì„œë²„-ë™ì‘-phoenix)
6. [AI ì´ë²¤íŠ¸ ì—°ê³„](#ai-ì´ë²¤íŠ¸-ì—°ê³„)
7. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°](#ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°)
8. [í–¥í›„ í™•ì¥ ê³„íš](#í–¥í›„-í™•ì¥-ê³„íš)
9. [ë³€ê²½ ì´ë ¥](#ë³€ê²½-ì´ë ¥)

---

## 1. ê°œìš”

INSWING ì‹¤ì‹œê°„ ì½”ì¹­ì€ ê³¨í¼, ì½”ì¹˜, AIê°€ í•œ ì„¸ì…˜ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ê¸°ë°˜ì˜ í”¼ë“œë°±ì„ ì£¼ê³ ë°›ëŠ” ì‹œìŠ¤í…œì´ë‹¤.

### íŠ¹ì§•

- ë¹„ë””ì˜¤ ì—…ë¡œë“œ í›„ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì •ì  ì„œë¹„ìŠ¤ê°€ ì•„ë‹˜
- ì½”ì¹­ ì—­ì‹œ ëŒ€í™”í˜•Â·ì¦‰ì‹œì„±Â·ìƒí˜¸ì‘ìš© ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„
- ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ëª¨ë‘ ë™ì¼í•œ ê²½í—˜ ì œê³µ

---

## 2. ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ êµ¬ì¡°

```
í”„ë¡ íŠ¸ì—”ë“œ (WebSocket Client)
        â†•
Phoenix WebSocket (inswing-realtime)
        â†•
MySQL (chat_messages)
```

### ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìƒì„± íë¦„

1. ì‚¬ìš©ì í–‰ë™ / AI ì´ë²¤íŠ¸ / API ì²˜ë¦¬
2. inswing-realtime ì„œë²„ë¡œ HTTP ì´ë²¤íŠ¸ ì „ë‹¬
3. Phoenixê°€ `session:{session_id}` ì±„ë„ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
4. í´ë¼ì´ì–¸íŠ¸ UI ì—…ë°ì´íŠ¸

---

## 3. ì´ë²¤íŠ¸ ê·œê²©

### ê¸°ë³¸ payload ê³µí†µ í•„ë“œ

| í•„ë“œ | ì„¤ëª… |
|------|------|
| `type` | ì´ë²¤íŠ¸ ì¢…ë¥˜ |
| `session_id` | ì„¸ì…˜ ID |
| `author_role` | golfer / coach / ai |
| `author_id` | user ID |
| `message` | í•µì‹¬ ë‚´ìš© |
| `meta` | ë¶€ê°€ ë°ì´í„° (timestamp, swing_id ë“±) |

### ì „ì²´ ì´ë²¤íŠ¸ íƒ€ì… í‘œ

| type | ì„¤ëª… |
|------|------|
| `chat_message` | í…ìŠ¤íŠ¸ ê¸°ë°˜ ì‹¤ì‹œê°„ ë©”ì‹œì§€ |
| `swing_created` | ìƒˆ ìŠ¤ìœ™ ì—…ë¡œë“œ ì´ë²¤íŠ¸ |
| `swing_analyzed` | AI ë¶„ì„ ì™„ë£Œ |
| `ai_insight` | Claude AIê°€ ìƒì„±í•œ ì½”ì¹­/ë©˜íƒˆ ë©”ì‹œì§€ |
| `coach_tip` | ì½”ì¹˜ì˜ ê¸°ìˆ  ì½”ë©˜íŠ¸ |
| `feeling_update` | ê³¨í¼ê°€ ëŠë‚Œ ê¸°ë¡ |
| `focus_point` | íŠ¹ì • í”„ë ˆì„ ê°•ì¡° |
| `system_notice` | ì‹œìŠ¤í…œ ì•Œë¦¼ |

### Phoenix ë©”ì‹œì§€ ì˜ˆì‹œ

```json
{
  "topic": "session:sess_123",
  "event": "event:new",
  "payload": {
    "type": "chat_message",
    "session_id": "sess_123",
    "author_role": "golfer",
    "author_id": "user_12",
    "message": "ì´ë²ˆì—ëŠ” íƒ„ë„ê°€ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤.",
    "meta": {
      "swing_id": "sw_222",
      "ts": 1765032112000
    }
  }
}
```

---

## 4. í´ë¼ì´ì–¸íŠ¸ ë™ì‘

### WebSocket ì—°ê²°

```
wss://realtime.inswing.ai/socket/websocket?vsn=2.0.0
```

### ì±„ë„ join

```
session:{session_id}
```

### UI ê·œì¹™

| ìƒí™© | UI í–‰ë™ |
|------|---------|
| ë³¸ì¸ ë©”ì‹œì§€ | ìš°ì¸¡ ë§í’ì„  |
| ë‹¤ë¥¸ ì‚¬ëŒ ë©”ì‹œì§€ | ì¢Œì¸¡ ë§í’ì„  |
| AI ë©”ì‹œì§€ | ë³„ë„ ìŠ¤íƒ€ì¼, Insight ë°°ì§€ |
| ì‹œìŠ¤í…œ ë©”ì‹œì§€ | ì¤‘ì•™ ì •ë ¬, íšŒìƒ‰ |

---

## 5. ì„œë²„ ë™ì‘ (Phoenix)

### í•µì‹¬ ì±„ë„

- `InswingRealtimeWeb.SessionChannel`

### ë¡œì§ íë¦„

```
handle_in("event:new", payload)
  â†’ DB ì €ì¥ (chat_messages)
  â†’ broadcast! to session:{session_id}
  â†’ reply {:ok, status:"sent"}
```

### ë°ì´í„° ì ‘ê·¼

- `InswingRealtime.Chat.list_messages(session_id)`
- `InswingRealtime.Chat.create_message(attrs)`

---

## 6. AI ì´ë²¤íŠ¸ ì—°ê³„

ë¶„ì„ ì™„ë£Œ ë˜ëŠ” ì¡°ê±´ ì¶©ì¡± ì‹œ APIê°€ í˜¸ì¶œí•˜ê³  Phoenixê°€ ë¸Œë¡œë“œìºìŠ¤íŠ¸:

**ìŠ¤ìœ™ ë¶„ì„ ì™„ë£Œ â†’ API â†’ Realtime ì„œë²„ â†’ event:new**

### AI ì½”ì¹­ ì˜ˆì‹œ payload

```json
{
  "type": "ai_insight",
  "persona": "calm_mentor",
  "message": "ë°±ìŠ¤ìœ™ í†±ì—ì„œ ì˜¤ë¥¸ìª½ ì–´ê¹¨ê°€ ê³¼í•˜ê²Œ ë“¤ë¦¬ëŠ” ê²½í–¥ì´ ìˆì–´ìš”."
}
```

---

## 7. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

| ì»¬ëŸ¼ | ë°ì´í„° | ì„¤ëª… |
|------|--------|------|
| `session_id` | string | ì„¸ì…˜ ID |
| `type` | string | ì´ë²¤íŠ¸ íƒ€ì… |
| `author_role` | string | golfer / coach / ai |
| `author_id` | string | ì‚¬ìš©ì ID |
| `message` | text | ë©”ì‹œì§€ |
| `meta` | map | ts, swing_id ë“± |
| `inserted_at` | timestamp | ìƒì„±ì¼ |
| `updated_at` | timestamp | ìˆ˜ì •ì¼ |

### ê²€ìƒ‰ ê¸°ì¤€

- `ORDER BY inserted_at ASC`

---

## 8. í–¥í›„ í™•ì¥ ê³„íš

| ê¸°ëŠ¥ | ìš°ì„ ìˆœìœ„ |
|------|----------|
| íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° | â­ |
| ë©”ì‹œì§€ ì‚­ì œ & ìˆ˜ì • | â­ |
| íŒŒì¼/ì´ë¯¸ì§€ ë©”ì‹œì§€ | â­ |
| ë‹¤ì¤‘ ì½”ì¹˜ ì°¸ì—¬ | â­ |
| ì„¸ì…˜ ë…¹í™” & ë¦¬í”Œë ˆì´ | â—» |
| ìŒì„± ë©”ì‹œì§€ & ìŒì„± â†’ í…ìŠ¤íŠ¸ | â—» |
| ì›ê²© ìŠ¤ìœ™ ì¹´ë©”ë¼ ì—°ê²° | ì—°êµ¬ ë‹¨ê³„ |

---

## 9. ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë‚´ìš© | ì‘ì„±ì |
|------|------|--------|
| 2025-01 | ì´ˆê¸° ë¬¸ì„œ ìƒì„± | Brown |

---
